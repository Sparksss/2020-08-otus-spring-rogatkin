plugins {
    id 'org.springframework.boot' version '2.4.1'
    id 'io.spring.dependency-management' version '1.0.10.RELEASE'
    id 'java'
    id 'idea'
}
idea {
    project {
        languageLevel = 14
    }
    module {
        downloadJavadoc = true
        downloadSources = true
    }
}

def springBootVersion = '2.4.1'


dependencies {
    compileOnly 'org.projectlombok:lombok:1.18.16'
    annotationProcessor 'org.projectlombok:lombok:1.18.16'
    implementation "org.springframework.boot:spring-boot-starter:${springBootVersion}"
    implementation "org.springframework.boot:spring-boot-starter-data-jpa:${springBootVersion}"
    implementation "org.springframework.boot:spring-boot-starter-web:${springBootVersion}"
    implementation "org.springframework.boot:spring-boot-starter-thymeleaf:${springBootVersion}"
    implementation "org.springframework.boot:spring-boot-starter-data-mongodb:${springBootVersion}"
    implementation 'com.github.cloudyrock.mongock:mongock-spring-v5:4.1.17'
    implementation 'com.github.cloudyrock.mongock:mongodb-springdata-v3-driver:4.1.17'
    implementation 'org.flywaydb:flyway-core:6.4.4'
    runtimeOnly 'org.postgresql:postgresql:42.2.16'
    testCompileOnly 'de.flapdoodle.embed:de.flapdoodle.embed.mongo:3.0.0'
    testCompileOnly 'org.projectlombok:lombok:1.18.16'
    testAnnotationProcessor 'org.projectlombok:lombok:1.18.16'
    testRuntimeOnly 'com.h2database:h2:1.4.200'
    testCompile 'org.hamcrest:hamcrest-core:1.3'
    testImplementation "org.springframework.boot:spring-boot-starter-test:${springBootVersion}"
}

allprojects {

    sourceCompatibility = JavaVersion.VERSION_14

    group "ru.otus"

    repositories {
        mavenCentral()
    }


    apply plugin: "io.spring.dependency-management"
    dependencyManagement {
        dependencies {
            imports {
                mavenBom("org.springframework.boot:spring-boot-dependencies:${springBootVersion}")
            }
            dependency("org.projectlombok:lombok:1.18.16")
            dependency("org.springframework.shell:spring-shell-starter:2.0.1.RELEASE")
            dependency("org.springframework.boot:spring-boot-starter-data-jpa:${springBootVersion}")
            dependency("org.flywaydb:flyway-core:6.4.4")
            dependency("org.postgresql:postgresql:42.2.16")
            dependency("org.hamcrest:hamcrest-core:1.3")
            dependency("org.springframework.boot:spring-boot-starter-test:${springBootVersion}")
        }
    }
    configurations.all {
        resolutionStrategy {
            failOnVersionConflict()
        }
        resolutionStrategy {
            force("javax.servlet:servlet-api:2.4")
            force("commons-logging:commons-logging:1.1.1")
            force("commons-lang:commons-lang:2.5")
            force("org.codehaus.jackson:jackson-core-asl:1.8.8")
            force("org.codehaus.jackson:jackson-mapper-asl:1.8.3")
            force("org.codehaus.jettison:jettison:1.1")
            force("org.javassist:javassist:3.24.0-GA")
            force("org.apiguardian:apiguardian-api:1.1.0")
            force("org.opentest4j:opentest4j:1.2.0")
        }
    }
}